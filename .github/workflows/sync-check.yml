name: Documentation Sync Check

on:
  schedule:
    - cron: '0 9 * * 1-5'  # Every weekday at 9 AM
  workflow_dispatch:  # Manual trigger

permissions:
  contents: read
  issues: write

jobs:
  sync-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Claude Sync Analysis
        uses: anthropics/claude-code-action@v1
        with:
          prompt: |
            Perform a synchronization check between code and documentation:

            1. **Vibe Code Detection**: Find code modules in apps/ or src/ not referenced in docs/backlog/
            2. **Orphan Stories**: Find stories marked Done without corresponding implementation
            3. **Architecture Drift**: Compare docs/ARCHITECTURE.md with actual structure
            4. **Stale Documentation**: Check if README.md, STACK.md are up to date

            If issues are found, create a GitHub issue with the report using gh cli.
            Format the issue body with:
            - Health score (0-100)
            - List of problems found
            - Recommended actions

            Only create an issue if health_score < 80.
          allowed_tools: "Read,Glob,Grep,Bash(find:*),Bash(tree:*),Bash(gh issue:*)"
